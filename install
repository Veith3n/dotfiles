#!/bin/sh

# Install xcode CLI
xcode-select --install

# Install homebrew
# /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
# ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install.sh)"

# update hombrew
brew update
brew upgrade

# brew install homebrew/cask # homebrew cask (not sure if needed)

# Install homebrew dependencies
brew install fzf # fuzzy search
brew install direnv # looks for .envrc file in each directory

brew install gpg # managing keys 
# Hack for gpg https://stackoverflow.com/questions/39494631/gpg-failed-to-sign-the-data-fatal-failed-to-write-commit-object-git-2-10-0
brew upgrade gnupg
brew link --overwrite gnupg
brew install pinentry-mac
echo "pinentry-program /usr/local/bin/pinentry-mac" >> ~/.gnupg/gpg-agent.conf
killall gpg-agent

brew install zsh # neat CLI
brew install gnu-sed # GNU based sed
brew install bash # install new version of bash
echo "enter recovery mode and run csrutil disable, restart run set_new_bash_as_default, enter recovery mode again and run csrutil enable"
brew install aspell # spell checker

sh -c "$(curl -fsSL https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh)" # oh-my-zsh

brew install --cask iterm2 # install iterm2
brew install --cask docker # docker
brew install --cask slack # slack
brew install --cask visual-studio-code # visual-studio-code
brew install --cask dash # dash

brew install nodenv # install node_env

brew install java # install latest java version

brew install jenv # version manager for java

brew install pyenv # version manager for python

brew install pipenv # dependency manager for python

# Link config files to the root direcotry
[ -r .make_links ] && ./make_links

# Generate file with git aliases for zshrc
./bin/generate_git_aliases_for_zshrc

# Setup necessary entries to the config files
if [ -r ~/.zshrc ] 
then
	# initialize direnv in zshrc
	echo $'# direnv initialize\neval "$(direnv hook zsh)"' >> ~/.zshrc

	# initialize nodenv in zshrc
	echo $'# nodenv initialize\neval "$(nodenv init -)"' >> ~/.zshrc

	# initialize pyenv in zshrc
	echo $'# pyenv initialize\neval "$(pyenv init -)"' >> ~/.zshrc

	# initialize jenv in zshrc
	echo 'export PATH="$HOME/.jenv/bin:$PATH"' >> ~/.zshrc
	echo 'eval "$(jenv init -)"' >> ~/.zshrc

	# add git aliases
	sed -i '' -e '/^# Example aliases/a\
		[ -r ~/.zsh_git_aliases ] && . ~/.zsh_git_aliases' ~/.zshrc

	# source varables and path files in zshrc
	sed -i '' -e '1i \ 
		# Link file with paths \
		[ -r ~/.env_paths ] && . ~/.env_paths \
		# Link file with variables \
		[ -r ~/.env_variables ] && . ~/.env_variables \
		\' ~/.zshrc


echo 'plugins added'
else
	echo '.zshrc config file does not exist'
fi

source ~/.zshrc # reload changes to the config file

# add newest java version to the jenv path
java_path=$(/usr/libexec/java_home -V)
jenv add $java_path

# Rvm install
gpg --keyserver hkp://pool.sks-keyservers.net --recv-keys 409B6B1796C275462A1703113804BB82D39DC0E3 7D2BAF1CF37B13E2069D6956105BD0E739499BDB # public key for rvm
curl -sSL https://get.rvm.io | bash -s stable --ruby

